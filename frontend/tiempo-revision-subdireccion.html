<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Seguimiento Tiempo por Tiempo</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body class="bg-light">
<div id="navbar-container"></div>
  <div class="container mt-5">
    <h2 class="mb-4">üìã Solicitudes de Tiempo por Tiempo (Subdirecci√≥n)</h2>
    <div id="mensaje"></div>

    <table class="table table-bordered table-hover">
      <thead class="table-dark">
        <tr>
          <th>Docente</th>
          <th>Horas</th>
          <th>Motivo</th>
          <th>Estatus</th>
          <th>Revisado por</th>
        </tr>
      </thead>
      <tbody id="tablaTiempo"></tbody>
    </table>
  </div>

  <script>
    const token = localStorage.getItem('token');
    const tabla = document.getElementById('tablaTiempo');
    const mensaje = document.getElementById('mensaje');

    async function cargarSolicitudes() {
      try {
        const res = await fetch('/api/tiempo/solicitudes-creadas', {
          headers: { 'Authorization': `Bearer ${token}` }
        });
        const registros = await res.json();

        if (!res.ok) {
          mensaje.innerHTML = `<div class="alert alert-danger">‚ùå ${registros.mensaje || 'Error al obtener registros'}</div>`;
          return;
        }

        if (registros.length === 0) {
          tabla.innerHTML = `<tr><td colspan="5" class="text-center">No hay registros creados por ti.</td></tr>`;
          return;
        }

        registros.forEach(r => {
          const fila = document.createElement('tr');
          fila.innerHTML = `
            <td>${r.docente?.nombre || '-'}</td>
            <td>${r.horas}</td>
            <td>${r.motivo || '-'}</td>
            <td>
              <span class="badge bg-${r.estatus === 'Aceptado' ? 'success' : r.estatus === 'Rechazado' ? 'danger' : 'warning'}">
                ${r.estatus}
              </span>
            </td>
            <td>${r.revisadoPor?.nombre || '-'}</td>
          `;
          tabla.appendChild(fila);
        });
      } catch (err) {
        mensaje.innerHTML = `<div class="alert alert-danger">‚ö†Ô∏è Error de red</div>`;
      }
    }

    cargarSolicitudes();
  </script>
  <script src="js/navbar.js"></script>
  <script src="/socket.io/socket.io.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>