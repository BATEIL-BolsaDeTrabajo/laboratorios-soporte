<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Historial de Vacaciones</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body class="bg-light">
<div id="navbar-container"></div>
  <div class="container mt-5">
    <h2 class="mb-4">üìä Historial de Solicitudes de Vacaciones</h2>
    <div id="mensaje"></div>

    <table class="table table-bordered table-hover" id="tablaVacaciones">
      <thead class="table-dark">
        <tr>
          <th>Mes</th>
          <th>Fecha inicio</th>
          <th>Fecha fin</th>
          <th>D√≠as solicitados</th>
          <th>D√≠as restantes</th>
          <th>D√≠as por pagar</th>
          <th>Estatus</th>
          <th>Motivo</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>
    <hr class="my-5">
<h2 class="mb-4">‚è± Historial de Tiempo por Tiempo</h2>

<table class="table table-bordered table-hover" id="tablaTiempo">
  <thead class="table-dark">
    <tr>
      <th>Fecha</th>
      <th>Horas</th>
      <th>Motivo</th>
      <th>Estatus</th>
      <th>Revisado por</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td colspan="5" class="text-center text-muted">Pr√≥ximamente disponible...</td>
    </tr>
  </tbody>
</table>

  </div>

  <script>
    const token = localStorage.getItem('token'); // JWT guardado al iniciar sesi√≥n
    const tabla = document.querySelector('#tablaVacaciones tbody');
    const mensaje = document.getElementById('mensaje');

    async function cargarHistorial() {
      try {
        const res = await fetch('/api/vacaciones/mis-solicitudes', {
          headers: {
            'Authorization': `Bearer ${token}`
          }
        });

        const datos = await res.json();
        if (!res.ok) {
          mensaje.innerHTML = `<div class="alert alert-danger">‚ùå ${datos.mensaje || 'Error al obtener historial'}</div>`;
          return;
        }

        if (datos.length === 0) {
          tabla.innerHTML = `<tr><td colspan="8" class="text-center">No hay solicitudes registradas.</td></tr>`;
          return;
        }

        datos.forEach(s => {
          const fila = document.createElement('tr');

          const fechaInicio = new Date(s.fechaInicio);
          const mes = fechaInicio.toLocaleString('es-MX', { month: 'long', year: 'numeric' });

          fila.innerHTML = `
            <td>${mes}</td>
            <td>${fechaInicio.toLocaleDateString()}</td>
            <td>${new Date(s.fechaFin).toLocaleDateString()}</td>
            <td>${s.diasSolicitados}</td>
            <td>${s.diasRestantes ?? '-'}</td>
            <td>${s.diasPorPagar ?? 0}</td>
            <td>
              <span class="badge bg-${s.estatus === 'Aceptado' ? 'success' : s.estatus === 'Rechazado' ? 'danger' : 'warning'}">
                ${s.estatus}
              </span>
            </td>
            <td>${s.motivo || ''}</td>
          `;

          tabla.appendChild(fila);
        });
      } catch (err) {
        mensaje.innerHTML = `<div class="alert alert-danger">‚ö†Ô∏è Error de red</div>`;
      }
    }

    cargarHistorial();


  async function cargarTiempoPorTiempo() {
  const tablaTiempo = document.querySelector('#tablaTiempo tbody');
  tablaTiempo.innerHTML = ''; // limpia contenido por si acaso

  try {
    const res = await fetch('/api/tiempo/mis-registros', {
      headers: {
        'Authorization': `Bearer ${token}`
      }
    });

    const registros = await res.json();

    if (!res.ok) {
      tablaTiempo.innerHTML = `<tr><td colspan="5" class="text-center text-danger">‚ùå ${registros.mensaje || 'Error al obtener tiempo por tiempo'}</td></tr>`;
      return;
    }

    if (registros.length === 0) {
      tablaTiempo.innerHTML = `<tr><td colspan="5" class="text-center text-muted">Sin registros disponibles.</td></tr>`;
      return;
    }

    registros.forEach(r => {
      const fila = document.createElement('tr');
      fila.innerHTML = `
        <td>${new Date(r.fechaRegistro).toLocaleDateString()}</td>
        <td>${r.horas} h</td>
        <td>${r.motivo || '-'}</td>
        <td>
          <span class="badge bg-${r.estatus === 'Aceptado' ? 'success' : r.estatus === 'Rechazado' ? 'danger' : 'warning'}">
            ${r.estatus}
          </span>
        </td>
        <td>${r.revisadoPor?.nombre || '-'}</td>
      `;
      tablaTiempo.appendChild(fila);
    });
  } catch (err) {
    const tablaTiempo = document.querySelector('#tablaTiempo tbody');
    tablaTiempo.innerHTML = `<tr><td colspan="5" class="text-center text-danger">‚ö†Ô∏è Error de red</td></tr>`;
  }
}
cargarTiempoPorTiempo();

  </script>
  <script src="js/navbar.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
