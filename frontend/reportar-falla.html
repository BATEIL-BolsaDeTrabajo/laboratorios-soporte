<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <title>Reportar Falla</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" />
</head>
<body class="bg-light">

  <div id="navbar-container"></div>

  </nav>
  <div class="container py-5">
    <h2 class="mb-4 text-center">Reportar Falla en Computadora</h2>

    <form id="formFalla">
      <div class="mb-3">
        <label class="form-label">Laboratorio</label>
        <select class="form-select" id="laboratorio" required>
          <option value="">Selecciona...</option>
          <option>Lab 1</option>
          <option>Lab 2</option>
          <option>Lab 3</option>
        </select>
      </div>

      <div class="mb-3">
        <label class="form-label">Equipo</label>
        <input type="text" class="form-control" id="equipo" placeholder="Ej. PC3" required />
      </div>

      <div class="mb-3">
        <label class="form-label">Tipo de falla</label>
        <select class="form-select" id="tipoFalla" onchange="toggleDescripcion()" required>
          <option value="">Selecciona...</option>
          <option>Mouse</option>
          <option>Teclado</option>
          <option>Monitor</option>
          <option>Cableado</option>
          <option>Otro</option>
        </select>
      </div>

      <div class="mb-3" id="grupoDescripcion" style="display: none;">
        <label class="form-label">Descripción</label>
        <textarea class="form-control" id="descripcion" rows="3"></textarea>
      </div>

      <button type="submit" class="btn btn-primary w-100">Enviar Reporte</button>
      <div id="mensaje" class="mt-3 text-center text-success fw-bold"></div>
    </form>
  </div>
  <script>
  // Proteger acceso: si no hay token, redirige a login
  const token = localStorage.getItem("token");
  if (!token) {
    window.location.href = "login.html";
  }

  // Cerrar sesión
  function logout() {
    localStorage.removeItem("token");
    window.location.href = "login.html";
  }

  // Mostrar descripción si se selecciona "Otro"
  function toggleDescripcion() {
    const tipo = document.getElementById("tipoFalla").value;
    document.getElementById("grupoDescripcion").style.display = tipo === "Otro" ? "block" : "none";
  }

  // Envío del formulario
  document.getElementById("formFalla").addEventListener("submit", async function (e) {
    e.preventDefault();

    const laboratorio = document.getElementById("laboratorio").value;
    const equipo = document.getElementById("equipo").value;
    const tipoFalla = document.getElementById("tipoFalla").value;
    const descripcion = document.getElementById("descripcion").value;

    const res = await fetch("/api/fallas", {
      method: "POST",
      headers: {
        "Content-Type": "application/json",
        Authorization: `Bearer ${token}`
      },
      body: JSON.stringify({ laboratorio, equipo, tipoFalla, descripcion })
    });

    const data = await res.json();
    const mensaje = document.getElementById("mensaje");

    if (res.ok) {
      mensaje.textContent = "✅ Reporte enviado correctamente";
      mensaje.classList.remove("text-danger");
      mensaje.classList.add("text-success");
      this.reset();
      toggleDescripcion();
    } else {
      mensaje.textContent = "❌ Error: " + (data.mensaje || "no se pudo enviar");
      mensaje.classList.remove("text-success");
      mensaje.classList.add("text-danger");
    }
  });
</script>

  <script src="js/navbar.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

</body>
</html>